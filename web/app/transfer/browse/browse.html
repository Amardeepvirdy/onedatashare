<div class="file-list panel panel-default">
  <!-- Top of the widget where user enters a URI. -->
  <div class="panel-heading">
    <form class="uri" ng-submit="go(uri.text)">
      <div ng-controller="History as history" class="text-left input-group-lg"
           ng-class="uri.state" ng-init="uri.state.changed = true">
        <input class="uri-input form-control" type="text" ng-change="uri.state.changed = true"
               ng-model="uri.text" placeholder="Enter a URL">

        <!-- History dropdown menu. -->
        <div class="dropdown" ng-class="{open:history.show}">
          <ul tabindex="-1" ng-if="(history.list | filter:uri.text).length"
              class="dropdown-menu">
            <li ng-repeat="h in history.list | filter:uri.text">
              <a ng-click="history.show = false; go(h)" ng-bind="h"></a>
            </li>
          </ul>
        </div>

        <!-- Buttons on the right of the URI input. -->
        <span class="buttons">
          <button type="submit" class="large fa fa-arrow-right go" title="Go"></button>
          <button type="submit" class="large fa fa-repeat reload" title="Reload"></button>
          <button type="button" class="large fa fa-chevron-down history"
                  ng-class="history.show && 'active'"
                  ng-click="history.show = !history.show"></button>
        </span>
      </div>
    </form>
  </div>

  <!-- Toolbar for managing files. -->
  <div class="panel-heading form-inline transfer-toolbar">
    <div class="input-group col-md-8" style="white-space:nowrap">
      <div class="btn-group">
        <button class="btn btn-default" title="Previous Directory" ng-click="up_dir()">
          <i class="fa fa-level-up fa fa-flip-horizontal"></i>
          <i class="fa fa-folder-open"></i>
        </button>
      </div>
      <div class="btn-group">
        <button class="btn btn-default ph" ng-click="mkdir()" title="New folder">
          <i class="fa fa-folder-open"></i>
          <i class="fa fa-plus"></i>
        </button>
        <button class="fa fa-trash btn btn-default ph" title="Delete" ng-click="rm(selectedUris())"></button>
      </div>
      <div class="btn-group">
        <button class="btn btn-default" ng-class="{active:showHidden}" title="Toggle hidden"
                ng-click="showHidden = !showHidden">
          <i class="fa" ng-class="showHidden && 'fa-eye' || 'fa-eye-slash'"></i>
        </button>
      </div>
      <div class="btn-group">
        <button class="btn btn-default" title="Download" ng-click="download(selectedUris())">
          <i class="fa fa-download"></i>
        </button>
      </div>
      <div class="btn-group">
        <button class="btn btn-default" title="Authenticate" ng-click="selectCredentialModal()">
          <i class="fa fa-key"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Where files are displayed and can be browsed. -->
  <div class="tree" ng-class="{'hide-dots': !showHidden}">
    <div>
      <ul class="stork-list" ng-if="root && !error" ng-init="files = [root]"
          ng-include="'browse-node.html'">
      </ul>
      <ul class="stork-list" ng-if="error" class="alert-danger" style="overflow-x: auto">
        <li>
          <strong>Error:</strong> <span ng-bind="error"></span>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- A node in the file browser tree. -->
<script type="text/ng-template" id="browse-node.html">
  <li bindonce="root" ng-repeat="root in files | orderBy:['-dir','name']"
      bo-class="{ dir: root.dir, file: !root.dir, loading: loading,
                  dot: root.name && root.name.charAt(0) == '.' }"
      ng-class="{open:open}">
    <i class="fa text-muted toggle" ng-mousedown="root.dir && toggle()"
       ng-class="{'fa-minus-square-o': open, 'fa-plus-square-o': !open}"></i>
    <div ng-class="{'alert-info': selected, 'alert-warning': !!error}"
         ng-dblclick="toggle()" ng-mousedown="select($event)">
      <i class="fa" bo-class="{'fa-file': !root.dir}" ng-class="{'fa-folder': (root.dir && !open), 'fa-folder-open': (root.dir && open)}"></i>
      <span bo-bind="root.name"></span>
      <span class="small text-muted" bo-if="!root.dir"
            bo-bind="(root.size | size)+'B'"></span>
      <span class="fade fa fa-refresh text-muted" ng-class="loading && 'in fa-spin'"></span>
      <div class="small text-muted" style="padding-left:1em">
        <span bo-if="root.time" bo-bind="root.time*1000 | date:'medium'"></span>
        <span bo-bind="root.perm"></span>
      </div>
    </div>
    <ul ng-if="root.files" ng-init="files = root.files; selected = false; open = false"
        class="stork-list" ng-include="'browse-node.html'">
    </ul>
    <ul ng-if="error" class="alert-danger" style="overflow-x: auto">
      <li>
        <strong>Error:</strong> <span ng-bind="error"></span>
      </li>
    </ul>
  </li>
  <li ng-if="!files.length">
    <em ng-show="loading" class="text-muted">Loading...</em>
    <em ng-hide="loading" class="text-muted">(empty)</em>
  </li>
</script>

<!-- Modal dialog to create a new folder. -->
<script type="text/ng-template" id="new-folder.html">
  <div class="modal-header" ng-init="parent = selectedUris()[0]||uri().href()">
    <button type="button" class="close" ng-click="$dismiss()" aria-hidden="true">
      &times;
    </button>
    <h4 class="modal-title">
      <i class="fa fa-folder-open"></i>
      <i class="fa fa-plus"></i>
      Create a New Folder
    </h4>
  </div>
  <div class="modal-body">
    <div class="form-group col-sm-push-3 col-sm-6">
      <label>Name</label>
      <input type="text" class="form-control" ng-model="name" focus-me required>
    </div>
  </div>
  <div class="clearfix"></div>
  <div class="text-center modal-footer">
    <button type="submit" class="btn btn-primary">
      OK
    </button>
    <button ng-click="$dismiss()" type="button" class="btn btn-default">
      Cancel
    </button>
  </div>
</script>

<!-- Modal dialog to select a credential. -->
<script type="text/ng-template" id="select-credential.html">
  <div class="modal-header" ng-init="parent = selectedUris()[0]||uri().href()">
    <button type="button" class="close" ng-click="$dismiss()" aria-hidden="true">
      &times;
    </button>
    <h4 class="modal-title">
      <i class="fa fa-folder-open"></i>
      <i class="fa fa-plus"></i>
      Create a New Folder
    </h4>
  </div>
  <div class="modal-body">
    <div class="form-group col-sm-push-3 col-sm-6">
      <label>Name</label>
      <input type="text" class="form-control" ng-model="name" focus-me required>
    </div>
  </div>
  <div class="clearfix"></div>
  <div class="text-center modal-footer">
    <button type="submit" class="btn btn-primary">
      OK
    </button>
    <button ng-click="$dismiss()" type="button" class="btn btn-default">
      Cancel
    </button>
  </div>

  <div class="col-md-4" ng-controller="CredCtrl">
    <select ng-change="credChanged()" ng-model="end.cred"
            class="form-control dropdown-toggle" title="Select credential">
      <option value="">No credential</option>
      <optgroup label="Saved credentials">
        <option disabled ng-if="creds.length == 0">(none)</option>
        <option value="{{c.uuid}}" ng-repeat="c in creds">
          {{c.name || 'Unnamed ('+c.type+')'}}
        </option>
      </optgroup>
      <optgroup class="new-credential" label="New credential">
        <option value="new-myproxy">MyProxy</option>
      </optgroup>
    </select>
  </div>
</script>
